# Лабораторная работа №1 - Настроить Nginx 

## Цель работы

Научиться настраивать конфигурацию Nginx исходя из требований проектов.

## Ход работы

### 1. Установка nginx

Для установки Nginx на Ubuntu следуем следующим шагам:
1. Обновим списки пакетов: 
```bash
  sudo apt update
```
2. Установим Nginx:
```bash
sudo apt install nginx
```
3. Добавим Nginx в автозагрузку:
```bash
sudo systemctl enable nginx
```
4. Проверим статус Nginx:
```bash
sudo service nginx status
```
5. Убедимся, что Nginx доступен в автозагрузке:
```bash
sudo systemctl is-enabled nginx
```

### 2. Подготовка проектов

Можно взять любой проект или одностраничный html. Если у вас полноценный микро сервис, то нам нужен build проекта для 
этого выполним команду:
```bash
npm run build
```
Название команды может отличать взависимости от настроек проекта. Инструкции можно посмотреть в package.json.

Следующим шагом нам следует скопировать директорию проекта в /var/www/ для этого выполним следующую команду для 
каждого билда:
```bash
sudo cp -r ../../home/qoudo/optimization-methods/lab_1/project_2 project2.com 
```
Путь и название файлов у вас может отличаться. В данном случаи команда выполняется в /var/www/.

### 3. Настройка конфигурации
Откроем файл конфигурации default.conf, найти его можно в etc/nginx/conf.d:
```bash
sudo nano default.conf
```
Избавимся от дефолтной конфигурации и напишем свою:

```nginx
server { 
    # Указываем, что сервер будет слушать запросы на порту 80 (HTTP).
    # Определяем имя сервера, которое будет использоваться для обработки запросов. 
    # В данном случае используется подстановочный знак _, который соответствует любому имени сервера.
    # И перенаправляем все HTTP-запросы на HTTPS. Это делается путём возврата кода состояния HTTP 301 
    # (Moved Permanently), который указывает браузеру, что ресурс был перемещён навсегда на новый URL. 
    # Новый URL формируется путём добавления https к имени хоста ($host) и сохранения 
    # исходного пути запроса ($request_uri).
    
    listen 80 default_server;
    server_name _;
    return 301 https://$host$request_uri;
}

 # Определям два сервера, каждый из которых будет слушать запросы на порту 443 (HTTPS) и обрабатывать запросы, 
 # соответствующие определённому имени сервера (local.project1.com и local.project2.com соответственно).
 
 # Для локальной отладки используем префикс "local.", если же вы настраиваете конфигурацию на удаленном сервере, 
 # то стоит указать "www".

server {
    listen 443 ssl;
    server_name local.project1.com;

    # Указываем на файлы сертификата SSL и ключа, которые будут использоваться для шифрования данных между 
    # клиентом и сервером.

    ssl_certificate /usr/share/nginx/sert/selfsigned.crt;
    ssl_certificate_key /usr/share/nginx/sert/private.key;
     
    # Определяем правила обработки запросов. В данном случае:
    # - location / — указывает, что все запросы, начинающиеся с корня сайта (/), должны обрабатываться указанным 
    # блоком конфигурации.
    # - location /images/ — указывает, что все запросы, начинающиеся с /images/, должны обрабатываться путём 
    # поиска файлов в каталоге /var/www/project1.com/images/.

    location / {
    
        # Ограничиваем количество одновременных запросов к серверу, чтобы предотвратить его перегрузку.
        limit_req zone=req_limit burst=10 nodelay;
        
        # Указываем корневые каталоги сервисов, где находятся файлы, которые должны быть обработаны сервером.
        root /var/www/project1.com; 
        index index.html;
    }

    location /images/ {
      
      # Используем "alias" для обслуживания файлов, находящихся за пределами указанного корневого каталога (root). 
      # Она позволяет Nginx искать файлы в указанном каталоге и обслуживать их, как если бы они находились 
      # в корневом каталоге.
       alias /var/www/project1.com/images/;
    }
}

server {
     listen 443 ssl;
     server_name local.project2.com;

     ssl_certificate /usr/share/nginx/sert/selfsigned.crt;
     ssl_certificate_key /usr/share/nginx/sert/private.key;

     location / {
         limit_req zone=req_limit burst=10 nodelay;
         root /var/www/project2.com;
         index index.html;
     }
}
```
