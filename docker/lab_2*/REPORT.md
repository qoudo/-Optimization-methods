# Лабораторная работа №2* - Написание _Docker compose_ файла 

## Цель работы

Правильно писать _Docker Compose_ файлы и понимать основные практики и антипрактики.

## Ход работы

### Плохой Docker Compose

Начнем с создания "плохого" _Docker Compose_ файла и потом исправим его, а также разберём все ошибки.

```yaml
version: '3'
services:
  web1:
    image: nginx
    ports:
      - "80:80"
    volumes:
      - ./service_1:/usr/share/nginx/html

  web2:
    image: nginx
    ports:
      - "81:80"
    volumes:
      - ./service_2:/usr/share/nginx/html
    depends_on:
      - service_1
```

1. **Неуказанные версии образов:** Использование образа без версии может привести к проблемам с совместимостью и 
неожиданным изменениям при обновлениях.

2. **Проброшенные порты по умолчанию:** Использование стандартных портов `80` и `81` без указания хостового порта может 
привести к конфликтам, если на хосте уже используется этот порт.

3. **Зависимость одних сервисов от других без надобности:** Почему это плохо: Использование `depends_on` автоматически 
не гарантирует, что сервис будет запущен и доступен готовым к использованию. Это может вызвать ненужные задержки при 
развертывании.

### Корректный _Docker Compose_

```yaml
version: '3.8'
services:
  web1:
    image: nginx:1.21.3-alpine
    ports:
      - "8081:80"
    volumes:
      - ./service_1:/usr/share/nginx/html
    networks:
      - web1-net

  web2:
    image: nginx:1.21.3-alpine
    ports:
      - "8082:80"
    volumes:
      - ./service_2:/usr/share/nginx/html
    networks:
      - service_2-net

networks:
  service_1-net:
  service_2-net:
```

1. **Неуказанные версии образов:** В "хорошем" файле явно указана версия образа `nginx:1.21.3-alpine`. Обеспечивает 
стабильность и предсказуемость выполнения сервисов.

2. **Проброшенные порты по умолчанию:** Указаны уникальные порты хоста `8081` и `8082`, чтобы избежать конфликтов. 
Позволит избежать конфликтов портов и дало возможность развернуть несколько экземпляров без проблем.

3. **Зависимость одних сервисов от других без надобности:** Удаление `depends_on` для повышения автономности сервисов. 
Упрощает параллельный запуск сервисов и уменьшает временную зависимость одного от другого.

### Изоляция между контейнерами

В корректной версии _Docker Compose_ каждой службе присвоена своя собственная сеть `service_1-net` и `service_2-net`, 
что обеспечивает изоляцию сетей. Т.к. контейнеры из разных сетей не могут видеть друг друга.

**Принцип работы:** _Docker Compose_ позволяет определять пользовательские сети, и контейнеры, подключенные к разным 
сетям, не будут иметь сетевой доступ друг к другу. Это эффективно изолирует их на уровне контейнеров, обеспечивая 
дополнительный уровень безопасности и организованности.

## Вывод

Правильное написание _Docker Compose_ файлов является критически важным аспектом разработки и управления 
контейнеризованными приложениями. Что способствуют созданию более устойчивых, управляемых и безопасных 
многоконтейнерных приложений, которые легче развертывать, обновлять и поддерживать.

[назад](../lab_2/REPORT.md) | [меню](../../README.md)
